<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –∫–æ–º–∞–Ω–¥—ã</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/myteams.css">
</head>
<body>
<!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
<div class="profile-sidebar">
    <div class="logo-sidebar">
        <img src="/images/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø">
    </div>
    <ul class="profile-nav">
        <li><a href="/"><i>üè†</i> –ì–ª–∞–≤–Ω–∞—è</a></li>
        <li><a href="/contacts"><i>üìû</i> –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞</a></li>
        <li><a href="/my-teams" class="active"><i>üë•</i> –ú–æ–∏ –∫–æ–º–∞–Ω–¥—ã</a></li>
        <li><a href="/upcoming-games"><i>‚öΩ</i> –ë–ª–∏–∂–∞–π—à–∏–µ –∏–≥—Ä—ã</a></li>
        <li><a href="/my-courts"><i>üìç</i> –ú–æ–∏ –ø–ª–æ—â–∞–¥–∫–∏</a></li>
        <li><a href="/my-reviews"><i>‚úçÔ∏è</i> –ú–æ–∏ –æ—Ç–∑—ã–≤—ã</a></li>
        <li><a href="/settings"><i>‚öôÔ∏è</i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
        <li><a href="/logout"><i>üö™</i> –í—ã–π—Ç–∏</a></li>
    </ul>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
<div class="profile-content">
    <h1>–ú–æ–∏ –∫–æ–º–∞–Ω–¥—ã</h1>
    <button class="create-team-btn" id="createTeamBtn">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</button>

    <div class="teams-grid">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ–º–∞–Ω–¥ -->
        <#list teams as team>
        <div class="team-card" onclick="showTeamDetails(${team.id})">
            <h3>${team.name}</h3>
            <p><strong>–î–∞—Ç–∞:</strong> <span>${team.gameDate?string('dd MMMM yyyy')}</span></p>
            <p><strong>–í—Ä–µ–º—è:</strong> <span>${team.gameTime?string('HH:mm')}</span></p>
            <p><strong>–ü–ª–æ—â–∞–¥–∫–∞:</strong>
                <#if team.fieldId??>
                                <#assign fieldName = fields?filter(f -> f.id == team.fieldId)?first.name!'' />
                                <#if fieldName != ''>
                                    ${fieldName}
                                <#else>
                                    –ù–µ —É–∫–∞–∑–∞–Ω–∞
                                </#if>
                            <#else>
                                –ù–µ —É–∫–∞–∑–∞–Ω–∞
                            </#if>
            </p>
        </div>
        </#list>

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç –∫–æ–º–∞–Ω–¥ -->
        <#if !teams?? || teams?size == 0>
        <div class="no-teams-message">
            –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
        </div>
        </#if>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã -->
<div id="createTeamModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeModalBtn">&times;</span>
        <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É</h2>
        <form id="createTeamForm" action="/create-team" method="post">
            <input type="hidden" name="_csrf" value="${_csrf.token}"/>
            <div class="form-group">
                <label for="teamName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</label>
                <input type="text" id="teamName" name="name" required>
            </div>
            <div class="form-group">
                <label for="gameDate">–î–∞—Ç–∞ –∏–≥—Ä—ã</label>
                <input type="date" id="gameDate" name="gameDate" required>
            </div>
            <div class="form-group">
                <label for="gameTime">–í—Ä–µ–º—è –∏–≥—Ä—ã</label>
                <input type="time" id="gameTime" name="gameTime"
                           required
                           min="08:00" max="22:00"
                           value="18:00">
            </div>
             <div class="form-group">
                            <label for="playersCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</label>
                            <input type="number" id="playersCount" name="amount"
                                   min="1" max="20" value="5" required>
                        </div>
            <div class="form-group">
                <label for="court">–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞</label>
                <select id="court" name="fieldId" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–æ—â–∞–¥–∫—É</option>
                    <#list fields as field>
                    <option value="${field.id}">${field.name}</option>
                    </#list>
                </select>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelCreateBtn">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
            </div>
        </form>
    </div>
</div>

<!-- –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–∞–Ω–¥—ã -->
<div class="overlay" id="overlay"></div>
<div class="team-card-expanded" id="teamDetails">
    <h2 id="expandedTeamTitle">–ö–æ–º–∞–Ω–¥–∞ #<span id="teamId"></span></h2>
    <form id="editTeamForm" action="/update-team" method="post">
        <input type="hidden" name="_csrf" value="${_csrf.token}"/>
        <input type="hidden" id="editTeamId" name="teamId">
        <div class="form-group">
            <label for="editDate">–î–∞—Ç–∞ –∏–≥—Ä—ã</label>
            <input type="date" id="editDate" name="gameDate">
        </div>
        <div class="form-group">
            <label for="editTime">–í—Ä–µ–º—è –∏–≥—Ä—ã</label>
            <input type="time" id="editTime" name="gameTime">
        </div>
        <div class="form-group">
            <label for="editCourt">–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞</label>
            <select id="editCourt" name="fieldId">
                <#list fields as field>
                <option value="${field.id}">${field.name}</option>
                </#list>
            </select>
        </div>
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancelEditBtn">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="btn btn-primary" id="saveChangesBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            <button type="button" class="btn btn-danger" id="deleteTeamBtn">–£–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
        </div>
    </form>
</div>

<script>
     // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
       document.getElementById('createTeamBtn').addEventListener('click', function() {
           document.getElementById('createTeamModal').style.display = 'block';
       });

       // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
       document.getElementById('closeModalBtn').addEventListener('click', function() {
           document.getElementById('createTeamModal').style.display = 'none';
       });

       document.getElementById('cancelCreateBtn').addEventListener('click', function() {
           document.getElementById('createTeamModal').style.display = 'none';
       });

      // –•—Ä–∞–Ω–∏–º –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–∑ —à–∞–±–ª–æ–Ω–∞)
      const teamsData = {
          <#list teams as team>
          "${team.id}": {
              id: ${team.id},
              name: "${team.name?js_string}",
              gameDate: "${team.gameDate?string('yyyy-MM-dd')}",
              gameTime: "${team.gameTime?string('HH:mm')}",
              field: {
                  id: "${team.fieldId!''}",

              }
          }<#if team?has_next>,</#if>
          </#list>
      };

      // –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª–µ–π –∫–æ–º–∞–Ω–¥—ã (–±–µ–∑ AJAX)
      function showTeamDetails(teamId) {
          const team = teamsData[teamId];

          if (!team) {
              console.error('Team not found:', teamId);
              return;
          }

          // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏
          document.getElementById('teamId').textContent = team.id;
          document.getElementById('editTeamId').value = team.id;
          document.getElementById('expandedTeamTitle').textContent = team.name;
          document.getElementById('editDate').value = team.gameDate;
          document.getElementById('editTime').value = team.gameTime;
          document.getElementById('editCourt').value = team.field.id || '';

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
          document.getElementById('overlay').style.display = 'block';
          document.getElementById('teamDetails').style.display = 'block';
      }

       // –ó–∞–∫—Ä—ã—Ç–∏–µ –¥–µ—Ç–∞–ª–µ–π –∫–æ–º–∞–Ω–¥—ã
       document.getElementById('cancelEditBtn').addEventListener('click', function() {
           document.getElementById('overlay').style.display = 'none';
           document.getElementById('teamDetails').style.display = 'none';
       });

       // –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
       document.getElementById('deleteTeamBtn').addEventListener('click', function() {
           const teamId = document.getElementById('editTeamId').value;
           if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–æ–º–∞–Ω–¥—É?')) {
               fetch('/delete-team/' + teamId, {
                   method: 'DELETE',
                   headers: {
                       'X-CSRF-TOKEN': document.querySelector('input[name="_csrf"]').value
                   }
               })
               .then(response => {
                   if (response.ok) {
                       alert('–ö–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∞!');
                       location.reload();
                   }
               })
               .catch(error => console.error('Error:', error));
           }
       });

       // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ overlay
       document.getElementById('overlay').addEventListener('click', function() {
           document.getElementById('overlay').style.display = 'none';
           document.getElementById('teamDetails').style.display = 'none';
           document.getElementById('createTeamModal').style.display = 'none';
       });
</script>
</body>
</html>